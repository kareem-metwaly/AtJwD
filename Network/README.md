# NETWORK AtJw(+D)
The folder include all the files required to run the network including files to generate dataset, saved models and tesing results prepared for NTIRE 2020 Dehazing Challenge submitted from iPAL-NonLocal
(url: https://competitions.codalab.org competitions/22236)

Network for dehazing images
Team name: iPAL-NonLocal
Team leader: Kareem Metwaly (metwaly.kareem@gmail.com)
Team members:  Kareem Metwaly, Xuelu Li, Tiantong Guo, Vishal Monga 
Time: 03/26/2020

## PREREQUISITE 
To correctly run the test model, the following packages are required.
1. python 3.6 or higher.
2. PyTorch 1.0.1.
3. OpenCV.
4. The results from different proposed method stored in the 'resutls/' folder.

## TO-RUN-TESTING 
Navigate to the downloaded folder, in terminal, type:
	python test.py --cuda --model MODEL_NAME

where MODEL_NAME is either 'AtJw' or 'AtJw+D', --cuda option is for using GPU if available

## POST_PROCESSING
To get the post processing results, please copy please go to: 
	https://drive.google.com/drive/folders/1JmZDH_e2NduK6Pdqe7nv-LG9Kz7zZSyZ?usp=sharing

(the results generated from this code is pre-loaded in that post-processing folder)
(user can also copy the results from 'results/' to the post-processing ‘testsets’ folder)

## FILES
1. test.py: 
The file includes the test code for our proposed network.
Parser arguments: 
	--cuda (default = True) for running on the GPU to reproduce the submitted results, 
	--model (default = "AtJw") specifies the model being tested, 
	--dataset (default="testset") for the testset path.
	
Return: running time and the saving path for results.

2. model:
Folder that includes the saved pretrained model.
	(1) AtJw.pth: the pretrained model for our proposed network 'AtJw' using images provided in NTIRE 20 Dehazing Challenge (and some external images from NTIRE 19 and 18).
	(2) AtJw+D.pth: the pretrained model for our proposed network 'AtJw+D' using images provided in NTIRE 20 Dehazing Challenge (and some external images from NTIRE 19 and 18).

3. dense121AtJw_SE_separate_bottlenecks.py:
The network structure for our "AtJw" model.

4. dense121AtJw_SE_separate_bottlenecks_dilation_inception.py:
The network structure for our "AtJw+D" model.

5. mainATJw_ssim_encoder_freezed.py:
Training file for the first stage where the encoder is unlearnable (fixed).

6. mainATJw_ssim.py:
Training file for the second stage where the encoder is learnable (not-fixed).

7. dataset.py: 
File that contains the class for reading the dataset that is generated by the 'dataset_generation' folder.

8. dataset_generation:
Folder that contains al the files needed to generate the H5 file for training.

4. testset: 
The folder includes the test images from NTIRE 20 Dehazing Challenge.

5. results:
Folder that contains the output of the two proposed networks.

6. utils.py, common.py:
Files that contain some auxilary functions and classes that are needed during training and/or testing.

